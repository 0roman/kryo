language: java

env:
  global:
    - SONATYPE_USERNAME=martin.grotzke
    - secure: "IYbrSnn752JOqst10hQ/8DdLvP5vOr+xmM8fgkz8jwUqWhjdz47Hrw+X/uzNx+U4FfaDQeWKBHzb/ysxBDXf0X1NBzRN8vWXUCe6vo/mp+lCXLCzpDk0tBCJFauw9lMpIWqSdAA9X9MMvAUyb9Iux4Rgj+ZCobzdomSkSI0HVFs="
  
jdk:
  #- openjdk7
  - oraclejdk8

install:
  # compile and test java 8
  - mvn -B -V -f pom-main.xml clean test

script:
  # compile tests with java 8, but with testSource/testTarget 1.7 (disabled java8 profile), so that we can run tests with java 7
  - jdk_switcher use oraclejdk8
  - mvn -B -f pom-main.xml -P!java8 clean install
  # test java 7
  - jdk_switcher use openjdk7
  - mvn -B -f pom-main.xml surefire:test

after_success:
  # install and publish snapshot with java 8
  - jdk_switcher use oraclejdk8
  - test $TRAVIS_BRANCH = "master" && test $TRAVIS_PULL_REQUEST = "false" && mvn -B -P requireSnapshot -DskipTests=true deploy --settings .settings.xml
  #- mvn -B -P requireSnapshot -DskipTests=true deploy --settings .settings.xml

cache:
  directories:
    - $HOME/.m2

# use container
sudo: false
